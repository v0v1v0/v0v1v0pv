<div class="container">

<table style="width: 100%;"><tr>
<td>oecosimu</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Evaluate Statistics with Null Models of Biological Communities </h2>

<h3>Description</h3>

<p>Function evaluates a statistic or a vector of statistics in
community and evaluates its significance in a series of simulated
random communities.  The approach has been used traditionally for
the analysis of nestedness, but the function is more general and can
be used with any statistics evaluated with simulated
communities. Function <code>oecosimu</code> collects and evaluates the
statistics. The Null model communities are described in
<code>make.commsim</code> and <code>permatfull</code>/
<code>permatswap</code>, the definition of Null models in
<code>nullmodel</code>, and nestedness statistics in
<code>nestednodf</code> (which describes several alternative
statistics, including nestedness temperature, <code class="reqn">N0</code>, checker
board units, nestedness discrepancy and NODF).
</p>


<h3>Usage</h3>

<pre><code class="language-R">oecosimu(comm, nestfun, method, nsimul = 99, burnin = 0, thin = 1,
   statistic = "statistic", alternative = c("two.sided", "less", "greater"), 
   batchsize = NA, parallel = getOption("mc.cores"), ...)
## S3 method for class 'oecosimu'
as.ts(x, ...)
## S3 method for class 'oecosimu'
toCoda(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>comm</code></td>
<td>
<p>Community data, or a Null model object generated by
<code>nullmodel</code> or an object of class <code>simmat</code> (array
of permuted matrices from <code>simulate.nullmodel</code>). If
<code>comm</code> is a community data, null model simulation
<code>method</code> must be specified.  If <code>comm</code> is a
<code>nullmodel</code>, the simulation <code>method</code> is ignored,
and if <code>comm</code> is a <code>simmat</code> object, all other arguments
are ignored except <code>nestfun</code>, <code>statistic</code> and
<code>alternative</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nestfun</code></td>
<td>
<p>Function analysed. Some nestedness functions are
provided in <span class="pkg">vegan</span> (see <code>nestedtemp</code>), but any
function can be used if it accepts the community as the first
argument, and returns either a plain number or a vector or the
result in list item with the name defined in argument
<code>statistic</code>. See Examples for defining your own functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Null model method: either a name (character string) of
a method defined in <code>make.commsim</code> or a
<code>commsim</code> function. This argument is ignored if
<code>comm</code> is a <code>nullmodel</code> or a <code>simmat</code>
object. See Details and Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsimul</code></td>
<td>
<p>Number of simulated null communities (ignored if
<code>comm</code> is a <code>simmat</code> object).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>
<p>Number of null communities discarded before proper
analysis in sequential methods (such as <code>"tswap"</code>)
(ignored with non-sequential methods or when <code>comm</code> is a
<code>simmat</code> object).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>Number of discarded null communities between two
evaluations of nestedness statistic in sequential methods (ignored
with non-sequential methods or when <code>comm</code> is a <code>simmat</code>
object).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>The name of the statistic returned by
<code>nestfun</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>a character string specifying the alternative
hypothesis, must be one of <code>"two.sided"</code> (default), <code>"greater"</code>
or <code>"less"</code>. Please note that the <code class="reqn">p</code>-value of two-sided
test is approximately two times higher than in the corresponding
one-sided test (<code>"greater"</code> or <code>"less"</code> depending on the
sign of the difference).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batchsize</code></td>
<td>
<p>Size in Megabytes of largest simulation object. If
a larger structure would be produced, the analysis is broken
internally into batches. With default <code>NA</code> the analysis is
not broken into batches.  See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Number of parallel processes or a predefined socket
cluster.  With <code>parallel = 1</code> uses ordinary, non-parallel
processing. The parallel processing is done with <span class="pkg">parallel</span>
package.  If you define a <code>nestfun</code> in Windows that needs other
<span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> packages than <span class="pkg">vegan</span> or <span class="pkg">permute</span>, you must set up a
socket cluster before the call. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An <code>oecosimu</code> result object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments to functions.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>oecosimu</code> is a wrapper that evaluates a statistic
using function given by <code>nestfun</code>, and then simulates a series
of null models based on <code>nullmodel</code>, and evaluates the
statistic on these null models. The <span class="pkg">vegan</span> packages contains
some nestedness functions that are described separately
(<code>nestedchecker</code>, <code>nesteddisc</code>,
<code>nestedn0</code>, <code>nestedtemp</code>,
<code>nestednodf</code>), but many other functions can be used as
long as they are meaningful with simulated communities.  An
applicable function must return either the statistic as a plain
number or a vector, or as a list element <code>"statistic"</code> (like
<code>chisq.test</code>), or in an item whose name is given in the
argument <code>statistic</code>.  The statistic can be a single number
(like typical for a nestedness index), or it can be a vector. The
vector indices can be used to analyse site (row) or species (column)
properties, see <code>treedive</code> for an example. Raup-Crick
index (<code>raupcrick</code>) gives an example of using a
dissimilarities.
</p>
<p>The Null model type can be given as a name (quoted character string)
that is used to define a Null model in <code>make.commsim</code>.
These include all binary models described by Wright et al. (1998),
Jonsson (2001), Gotelli &amp; Entsminger (2003), Miklós &amp;
Podani (2004), and some others. There are several quantitative Null
models, such those discussed by Hardy (2008), and several that are
unpublished (see <code>make.commsim</code>,
<code>permatfull</code>, <code>permatswap</code> for
discussion). The user can also define her own <code>commsim</code>
function (see Examples).
</p>
<p>Function works by first defining a <code>nullmodel</code> with
given <code>commsim</code>, and then generating a series of
simulated communities with <code>simulate.nullmodel</code>. A
shortcut can be used for any of these stages and the input can be
</p>

<ol>
<li>
<p> Community data (<code>comm</code>), Null model function
(<code>nestfun</code>) and the number of simulations (<code>nsimul</code>).
</p>
</li>
<li>
<p> A <code>nullmodel</code> object and the number of
simulations, and argument <code>method</code> is ignored.
</p>
</li>
<li>
<p> A three-dimensional array of simulated communities generated
with <code>simulate.nullmodel</code>, and arguments
<code>method</code> and <code>nsimul</code> are ignored.  
</p>
</li>
</ol>
<p>The last case allows analysing several statistics with the same
simulations.
</p>
<p>The function first generates simulations with given
<code>nullmodel</code> and then analyses these using the
<code>nestfun</code>.  With large data sets and/or large number of
simulations, the generated objects can be very large, and if the
memory is exhausted, the analysis can become very slow and the
system can become unresponsive. The simulation will be broken into
several smaller batches if the simulated <code>nullmodel</code>
objective will be above the set <code>batchsize</code> to avoid memory
problems (see <code>object.size</code> for estimating the size of
the current data set). The parallel processing still increases the
memory needs.  The parallel processing is only used for evaluating
<code>nestfun</code>.  The main load may be in simulation of the
<code>nullmodel</code>, and <code>parallel</code> argument does not help
there.
</p>
<p>Function <code>as.ts</code> transforms the simulated results of sequential
methods into a time series or a <code>ts</code> object. This allows
using analytic tools for time series in studying the sequences (see
examples). Function <code>toCoda</code> transforms the simulated results
of sequential methods into an <code>"mcmc"</code> object of the
<a href="https://CRAN.R-project.org/package=coda"><span class="pkg">coda</span></a> package. The <span class="pkg">coda</span> package provides functions for
the analysis of stationarity, adequacy of sample size,
autocorrelation, need of burn-in and much more for sequential
methods, and summary of the results. Please consult the
documentation of the <span class="pkg">coda</span> package.
</p>
<p>Function <code>permustats</code> provides support to the standard
<code>density</code>, <code>densityplot</code>,
<code>qqnorm</code> and <code>qqmath</code> functions for
the simulated values.
</p>


<h3>Value</h3>

 
<p>Function <code>oecosimu</code> returns an object of class
<code>"oecosimu"</code>.  The result object has items <code>statistic</code> and
<code>oecosimu</code>.  The <code>statistic</code> contains the complete object
returned by <code>nestfun</code> for the original data.  The
<code>oecosimu</code> component contains the following items:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>Observed values of the statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simulated</code></td>
<td>
<p>Simulated values of the statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>means</code></td>
<td>
<p>Mean values of the statistic from simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>Standardized effect sizes (SES, a.k.a. the <code class="reqn">z</code>-values)
of the observed statistic based on simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval</code></td>
<td>
<p>The <code class="reqn">P</code>-values of the statistic based on simulations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>The type of testing as given in argument <code>alternative</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>The <code>method</code> used in <code>nullmodel</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>isSeq</code></td>
<td>
<p><code>TRUE</code> if <code>method</code> was sequential.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>If you wonder about the name of <code>oecosimu</code>, look at journal
names in the References (and more in <code>nestedtemp</code>).  
</p>
<p>The internal structure of the function was radically changed in
<span class="pkg">vegan 2.2-0</span> with introduction of <code>commsim</code> and
<code>nullmodel</code> and deprecation of
<code>commsimulator</code>.
</p>


<h3>Author(s)</h3>

<p>Jari Oksanen and Peter Solymos</p>


<h3>References</h3>

<p>Hardy, O. J. (2008) 
Testing the spatial phylogenetic structure of local communities: 
statistical performances of different null models 
and test statistics on a locally neutral community. 
<em>Journal of Ecology</em> 96, 914–926.
</p>
<p>Gotelli, N.J. &amp; Entsminger, N.J. (2003). Swap algorithms in null model
analysis. <em>Ecology</em> 84, 532–535.
</p>
<p>Jonsson, B.G. (2001) A null model for randomization tests of
nestedness in species assemblages. <em>Oecologia</em> 127, 309–313.
</p>
<p>Miklós, I. &amp; Podani, J. (2004). Randomization of presence-absence
matrices: comments and new algorithms. <em>Ecology</em> 85, 86–92.
</p>
<p>Wright, D.H., Patterson, B.D., Mikkelson, G.M., Cutler, A. &amp; Atmar,
W. (1998). A comparative analysis of nested subset patterns of species
composition. <em>Oecologia</em> 113, 1–20.
</p>


<h3>See Also</h3>

<p>Function <code>oecosimu</code> currently defines null models with
<code>commsim</code> and generates the simulated null model
communities with <code>nullmodel</code> and
<code>simulate.nullmodel</code>. For other applications of
<code>oecosimu</code>, see <code>treedive</code> and
<code>raupcrick</code>.
</p>
<p>See also <code>nestedtemp</code> (that also discusses other
nestedness functions) and <code>treedive</code> for another
application.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Use the first eigenvalue of correspondence analysis as an index
## of structure: a model for making your own functions.
data(sipoo)
## Traditional nestedness statistics (number of checkerboard units)
oecosimu(sipoo, nestedchecker, "r0")
## sequential model, one-sided test, a vector statistic
out &lt;- oecosimu(sipoo, decorana, "swap", burnin=100, thin=10, 
   statistic="evals", alt = "greater")
out
## Inspect the swap sequence as a time series object
plot(as.ts(out))
lag.plot(as.ts(out))
acf(as.ts(out))
## Density plot
densityplot(permustats(out), as.table = TRUE, layout = c(1,4))
## Use quantitative null models to compare
## mean Bray-Curtis dissimilarities
data(dune)
meandist &lt;- function(x) mean(vegdist(x, "bray"))
mbc1 &lt;- oecosimu(dune, meandist, "r2dtable")
mbc1

## Define your own null model as a 'commsim' function: shuffle cells
## in each row
foo &lt;- function(x, n, nr, nc, ...) {
   out &lt;- array(0, c(nr, nc, n))
   for (k in seq_len(n))
      out[,,k] &lt;- apply(x, 2, function(z) sample(z, length(z)))
   out
}
cf &lt;- commsim("myshuffle", foo, isSeq = FALSE, binary = FALSE, 
   mode = "double")
oecosimu(dune, meandist, cf)

## Use pre-built null model
nm &lt;- simulate(nullmodel(sipoo, "curveball"), 99)
oecosimu(nm, nestedchecker)
## Several chains of a sequential model -- this can be generalized
## for parallel processing (see ?smbind)
nm &lt;- replicate(5, simulate(nullmodel(sipoo, "swap"), 99,
   thin=10, burnin=100), simplify = FALSE)
## nm is now a list of nullmodels: use smbind to combine these into one
## nullmodel with several chains
## IGNORE_RDIFF_BEGIN
nm &lt;- smbind(nm, MARGIN = 3)
nm
oecosimu(nm, nestedchecker)
## IGNORE_RDIFF_END
## After this you can use toCoda() and tools in the coda package to
## analyse the chains (these will show that thin, burnin and nsimul are
## all too low for real analysis).
</code></pre>


</div>