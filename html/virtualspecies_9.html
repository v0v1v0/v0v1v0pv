<div class="container">

<table style="width: 100%;"><tr>
<td>generateSpFromPCA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate a virtual species distribution with a PCA of environmental variables</h2>

<h3>Description</h3>

<p>This functions generates a virtual species distribution by computing a
PCA among environmental variables, and simulating the response of the species
along the two first axes of the PCA. The response to axes of the PCA is 
determined with gaussian functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">generateSpFromPCA(
  raster.stack,
  rescale = TRUE,
  niche.breadth = "any",
  axes = c(1, 2),
  means = NULL,
  sds = NULL,
  pca = NULL,
  sample.points = FALSE,
  nb.points = 10000,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>raster.stack</code></td>
<td>
<p>a SpatRaster object, in which each layer represent an
environmental 
variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rescale</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>. Should the output suitability 
raster be
rescaled between 0 and 1?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niche.breadth</code></td>
<td>
<p><code>"any"</code>, <code>"narrow"</code> or <code>"wide"</code>. This 
parameter
defines how tolerant is the species regarding environmental conditions by
adjusting
the standard deviations of the gaussian functions. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axes</code></td>
<td>
<p>a vector of values. Which axes would you like to keep in your 
PCA? 
At least 2 axes should be included (Only 1 axis currently not supported)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>means</code></td>
<td>
<p>a vector containing as many numeric values as axes. Will be 
used to define
the means of the gaussian response functions to the axes of the PCA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sds</code></td>
<td>
<p>a vector containing as many numeric values as axes. Will be 
used to define
the standard deviations of the gaussian response functions to the axes of 
the PCA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pca</code></td>
<td>
<p>a <code>dudi.pca</code> object. You can provide a pca object that you 
computed yourself with <code>dudi.pca</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.points</code></td>
<td>
<p><code>TRUE</code> of <code>FALSE</code>. If you have a large
raster file then use this parameter to sample a number of points equal to
<code>nb.points</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb.points</code></td>
<td>
<p>a numeric value. Only useful if <code>sample.points = TRUE</code>.
The number of sampled points from the raster, to perform the PCA. A too small
value may not be representative of the environmental conditions in your 
raster.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>. If <code>TRUE</code>, the generated 
virtual species will be plotted.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><a href="http://borisleroy.com/virtualspecies_tutorial/03-PCA.html">Online 
tutorial for this function</a>
</p>
<p>This function proceeds in 3 steps:
</p>

<ol>
<li>
<p>A PCA of environmental conditions is generated
</p>
</li>
<li>
<p>Gaussian responses to the first two axes are computed
</p>
</li>
<li>
<p>These responses are multiplied to obtain the final environmental 
suitability</p>
</li>
</ol>
<p>If <code>rescale = TRUE</code>, the final environmental suitability is rescaled 
between 0 and 1,
with the formula (val - min) / (max - min).
</p>
<p>The shape of gaussian responses can be randomly generated by the function or
defined manually by choosing
<code>means</code> and <code>sds</code>. The random generation is constrained
by the argument <code>niche.breadth</code>, which controls the range of possible 
standard deviation values. This range of values is based on
a fraction of the axis:
</p>

<ul>
<li>
<p><code>"any"</code>: the standard deviations can have values from 1% to 
50% of axes' ranges. For example if the first axis of the PCA ranges from 
-5 to +5,
then sd values along this axis can range from 0.1 to 5.

</p>
</li>
<li>
<p><code>"narrow"</code>: the standard deviations are limited between 1% and 
10% of axes' ranges. For example if the first axis of the PCA ranges from 
-5 to +5,
then sd values along this axis can range from 0.1 to 1.

</p>
</li>
<li>
<p><code>"wide"</code>: the standard deviations are limited between 10% and 
50% of axes' ranges. For example if the first axis of the PCA ranges from 
-5 to +5,
then sd values along this axis can range from 1 to 5.

</p>
</li>
</ul>
<h3>Value</h3>

<p>a <code>list</code> with 3 elements:
</p>

<ul>
<li>
<p><code>approach</code>: the approach used to generate the species, 
<em>i.e.</em>, <code>"pca"</code>
</p>
</li>
<li>
<p><code>details</code>: the details and parameters used to generate 
the species
</p>
</li>
<li>
<p><code>suitab.raster</code>: the virtual species distribution, as a 
SpatRaster object containing the
environmental suitability
</p>
</li>
</ul>
<p>The structure of the virtualspecies object can be seen using <code>str()</code>
</p>


<h3>Note</h3>

<p>To perform the PCA, the function has to transform the raster into a matrix.
This may not be feasible if the raster is too large for the 
computer's memory.
In this case, you should perform the PCA on a sample of your raster with
set <code>sample.points = TRUE</code> and choose the number of points to sample 
with
<code>nb.points</code>.
</p>


<h3>Author(s)</h3>

<p>Boris Leroy <a href="mailto:leroy.boris@gmail.com">leroy.boris@gmail.com</a>
</p>
<p>with help from C. N. Meynard, C. Bellard &amp; F. Courchamp
</p>


<h3>See Also</h3>

<p><code>generateSpFromFun</code> to generate a virtual species with
the responses to each environmental variables.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create an example stack with four environmental variables
a &lt;- matrix(rep(dnorm(1:100, 50, sd = 25)), 
            nrow = 100, ncol = 100, byrow = TRUE)
env &lt;- c(rast(a * dnorm(1:100, 50, sd = 25)),
             rast(a * 1:100),
             rast(a * logisticFun(1:100, alpha = 10, beta = 70)),
             rast(t(a)))
names(env) &lt;- c("var1", "var2", "var3", "var4")
plot(env) # Illustration of the variables





# Generating a species with the PCA

generateSpFromPCA(raster.stack = env)

# The top part of the plot shows the PCA and the response functions along
# the two axes.
# The bottom part shows the probabilities of occurrence of the virtual
# species.





# Defining manually the response to axes

generateSpFromPCA(raster.stack = env,
           means = c(-2, 0),
           sds = c(0.6, 1.5))
           
# This species can be seen as occupying intermediate altitude ranges of a
# conic mountain.


# Beyond the first two axes
generateSpFromPCA(raster.stack = env,
                  axes = c(1, 3))
                  
sp &lt;- generateSpFromPCA(raster.stack = env,
                  axes = 1:3)
plotResponse(sp, axes = c(1, 2))
plotResponse(sp, axes = c(1, 3))
plotResponse(sp, axes = c(2, 3))
           
</code></pre>


</div>