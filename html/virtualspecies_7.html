<div class="container">

<table style="width: 100%;"><tr>
<td>generateSpFromBCA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate a virtual species distribution from a Between Component Analysis 
of environmental variables</h2>

<h3>Description</h3>

<p>A Between Component Analysis is similar to a PCA, except that two sets of 
environmental conditions 
(e.g. current and future) will be used. This function is useful to generate 
species designed to test the extrapolation capacity of models, e.g.  
for climate change extrapolations
</p>


<h3>Usage</h3>

<pre><code class="language-R">generateSpFromBCA(
  raster.stack.current,
  raster.stack.future,
  rescale = TRUE,
  niche.breadth = "any",
  means = NULL,
  sds = NULL,
  bca = NULL,
  sample.points = FALSE,
  nb.points = 10000,
  plot = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>raster.stack.current</code></td>
<td>
<p>a SpatRaster object, in which each layer 
represent an environmental 
variable from the "current" time horizon.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raster.stack.future</code></td>
<td>
<p>a SpatRaster object, in which each layer 
represent an environmental 
variable from a "future" time horizon.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rescale</code></td>
<td>
<p><code>TRUE</code> of <code>FALSE</code>. Should the output suitability 
raster be
rescaled between 0 and 1?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niche.breadth</code></td>
<td>
<p><code>"any"</code>, <code>"narrow"</code> or <code>"wide"</code>. This
parameter
defines how tolerant is the species regarding environmental conditions by 
adjusting
the standard deviations of the gaussian functions. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>means</code></td>
<td>
<p>a vector containing two numeric values. Will be used to define
the means of the gaussian response functions to the axes of the BCA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sds</code></td>
<td>
<p>a vector containing two numeric values. Will be used to define
the standard deviations of the gaussian response functions to the axes of 
the BCA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bca</code></td>
<td>
<p>a <code>bca</code> object. You can provide a bca object that you 
already computed yourself with 
<code>generateSpFromBCA</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample.points</code></td>
<td>
<p><code>TRUE</code> of <code>FALSE</code>. If you have large
raster files then use this parameter to sample a number of points equal to
<code>nb.points</code>. However the representation of your environmental variables
will not be complete.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb.points</code></td>
<td>
<p>a numeric value. Only useful if <code>sample.points = TRUE</code>.
The number of sampled points from the raster, to perform the PCA. A too small
value may not be representative of the environmental conditions in your 
rasters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p><code>TRUE</code> or <code>FALSE</code>. If <code>TRUE</code>, the generated 
virtual species will be plotted.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function generates a virtual species distribution by computing a Between
Component Analysis based on two different stacks of environmental variables.
The response of the species is then simulated along the two first axes of 
the BCA with gaussian functions in the
same way as in <code>generateSpFromPCA</code>.
</p>
<p>A Between Component Analysis is used to separate two sets of environmental 
conditions.
This function proceeds in 4 steps:
</p>

<ol>
<li>
<p>A Principal Component Analysis is generated based on both set of 
environmental conditions
</p>
</li>
<li>
<p>A BCA of this PCA is generated using the function 
<code>bca</code>
from package <code>ade4</code>. Note that at this step we choose  one random point
from <code>raster.stack.future</code>,
and we use this single point as if it was a third set of environmental
conditions for the BCA. This trick allows us to subtly change the shape of 
the bca in order to
generate different types of conditions.
</p>
</li>
<li>
<p>Gaussian responses to the first two axes are computed
</p>
</li>
<li>
<p>These responses are multiplied to obtain the final environmental 
suitability</p>
</li>
</ol>
<p>If <code>rescale = TRUE</code>, the final environmental suitability is rescaled 
between 0 and 1,
with the formula (val - min) / (max - min).
</p>
<p>The shape of gaussian responses can be randomly generated by the function 
or defined manually by choosing
<code>means</code> and <code>sds</code>. The random generation is constrained
by the argument <code>niche.breadth</code>, which controls the range of possible 
standard deviation values. This range of values is based on
a fraction of the axis:
</p>

<ul>
<li>
<p><code>"any"</code>: the standard deviations can have values from 1% to 
50% of axes' ranges. For example if the first axis of the PCA ranges from 
-5 to +5,
then sd values along this axis can range from 0.1 to 5.

</p>
</li>
<li>
<p><code>"narrow"</code>: the standard deviations are limited between 1% and 
10% of axes' ranges. For example if the first axis of the PCA ranges from 
-5 to +5,
then sd values along this axis can range from 0.1 to 1.

</p>
</li>
<li>
<p><code>"wide"</code>: the standard deviations are limited between 10% and 
50% of axes' ranges. For example if the first axis of the PCA ranges from 
-5 to +5,
then sd values along this axis can range from 1 to 5.

</p>
</li>
</ul>
<p>If a <code>bca</code> object is provided, the output bca object will contain the 
new environments coordinates along the provided bca axes.
</p>


<h3>Value</h3>

<p>a <code>list</code> with 4 elements:
</p>

<ul>
<li>
<p><code>approach</code>: the approach used to generate the species, 
<em>i.e.</em>, <code>"bca"</code>
</p>
</li>
<li>
<p><code>details</code>: the details and parameters used to generate the 
species
</p>
</li>
<li>
<p><code>suitab.raster.current</code>: the virtual species distribution, as a 
SpatRaster object containing the
current environmental suitability
</p>
</li>
<li>
<p><code>suitab.raster.future</code>: the virtual species distribution, as a 
SpatRaster object containing the
future environmental suitability
</p>
</li>
</ul>
<p>The structure of the virtualspecies object can be seen using <code>str()</code>
</p>


<h3>Note</h3>

<p>To perform the BCA, the function has to transform rasters into matrices.
This may not be feasible if the chosen rasters are too large for the 
computer's memory.
In this case, you should run the function with <code>sample.points = TRUE</code> 
and set the number of points to sample with <code>nb.points</code>.
</p>


<h3>Author(s)</h3>

<p>Robin Delsol, Boris Leroy
</p>
<p>Maintainer: Boris Leroy <a href="mailto:leroy.boris@gmail.com">leroy.boris@gmail.com</a>
</p>


<h3>See Also</h3>

<p><code>generateSpFromFun</code> to generate a virtual species with
the responses to each environmental variables.<code>generateSpFromPCA</code>
to generate a virtual species with
the PCA of environmental variables.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Create two example stacks with four environmental variables each
a &lt;- matrix(rep(dnorm(1:100, 50, sd = 25)), 
            nrow = 100, ncol = 100, byrow = TRUE)

env1 &lt;- c(rast(a * dnorm(1:100, 50, sd = 25)),
          rast(a * 1:100),
          rast(a),
          rast(t(a)))
names(env1) &lt;- c("var1", "var2", "var3", "var4")
plot(env1) # Illustration of the variables

b &lt;- matrix(rep(dnorm(1:100, 25, sd = 50)), 
            nrow = 100, ncol = 100, byrow = TRUE)

env2 &lt;- c(rast(b * dnorm(1:100, 50, sd = 25)),
          rast(b * 1:100),
          rast(b),
          rast(t(b)))

names(env2) &lt;- c("var1", "var2", "var3", "var4")
plot(env2) # Illustration of the variables 

# Generating a species with the BCA

generateSpFromBCA(raster.stack.current = env1, raster.stack.future = env2)

# The left part of the plot shows the BCA and the response functions along
# the two axes.
# The top-right part shows environmental suitability of the virtual
# species in the current environment.
# The bottom-right part shows environmental suitability of the virtual
# species in the future environment. 


# Defining manually the response to axes

generateSpFromBCA(raster.stack.current = env1, raster.stack.future = env2,
           means = c(-2, 0),
           sds = c(0.6, 1.5))
   
                   
</code></pre>


</div>